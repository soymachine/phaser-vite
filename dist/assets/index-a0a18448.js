var y=Object.defineProperty;var I=(a,t,e)=>t in a?y(a,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):a[t]=e;var l=(a,t,e)=>(I(a,typeof t!="symbol"?t+"":t,e),e);(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))n(i);new MutationObserver(i=>{for(const o of i)if(o.type==="childList")for(const h of o.addedNodes)h.tagName==="LINK"&&h.rel==="modulepreload"&&n(h)}).observe(document,{childList:!0,subtree:!0});function e(i){const o={};return i.integrity&&(o.integrity=i.integrity),i.referrerPolicy&&(o.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?o.credentials="include":i.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function n(i){if(i.ep)return;i.ep=!0;const o=e(i);fetch(i.href,o)}})();class s{}s.version="0.0.8";s.LEFT="LEFT";s.RIGHT="RIGHT";s.TOP="TOP";s.BOTTOM="BOTTOM";s.CENTER="CENTER";s.LANDSCAPE="LANDSCAPE";s.PORTRAIT="PORTRAIT";s.easing="Cubic.easeOut";class r{constructor(){this.events={}}subscribe(t="",e){this.events[t]==null&&(this.events[t]=[]),this.events[t].push(e)}unsubscribe(t="",e){this.events[t]!=null&&(this.events[t]=this.events[t].filter(n=>n!==e))}notify(t="",e){var n;(n=this.events[t])==null||n.forEach(i=>i(e))}}r.myInstance=null;r.getInstance=()=>(r.myInstance==null&&(r.myInstance=new r),r.myInstance);r.ON_NODE_CHANGE="ON_NODE_CHANGE";r.ON_NODE_START_IN="ON_NODE_START_IN";r.ON_NODE_END_IN="ON_NODE_END_IN";r.ON_NODE_START_OUT="ON_NODE_START_OUT";r.ON_NODE_END_OUT="ON_NODE_END_OUT";r.ON_SWIPE_GESTURE="ON_SWIPE_GESTURE";r.ON_REQUEST_NEW_NODE="ON_REQUEST_NEW_NODE";r.ON_PROGRESS_LOADING="ON_PROGRESS_LOADING";r.ON_LOADING_COMPLETED="ON_LOADING_COMPLETED";r.ON_ORIENTATION_CHANGED="ON_ORIENTATION_CHANGED";class _ extends Phaser.Scene{constructor(){super({key:"BackgroundScene",active:!0});l(this,"gameScene");l(this,"layer");l(this,"onChange",e=>{switch(e){case s.LEFT:this.x-=this.offset;break;case s.RIGHT:this.x+=this.offset;break;case s.TOP:this.y-=this.offset;break;case s.BOTTOM:this.y+=this.offset;break}this.tweens.add({targets:this.view,x:this.x,y:this.y,duration:1e3,ease:s.easing,callbackScope:this,onComplete:function(){}})});this.offset=250,r.getInstance().subscribe(r.ON_NODE_CHANGE,this.onChange)}start(e){this.game=e,this.view=this.game.add.image(0,0,"bg").setOrigin(0,0),this.view.x=-1e3,this.view.y=-1e3,this.x=this.view.x,this.y=this.view.y}}class c{}c.W=0;c.H=0;class O{constructor(t){console.log("Constructor de Logger"),this.logs=[],this.label=t.text}log(t){this.logs.unshift(this.getNum()+" "+t),this.label.text=this.logs.join(`
`)}getNum(){return this.logs.length+1}}O.myInstance=null;O.getInstance=a=>(O.myInstance==null&&(O.myInstance=new O(a)),O.myInstance);class b extends Phaser.Scene{constructor(){super({key:"GameScene",active:!1});l(this,"cleanScenes",()=>{console.log("[cleanScenes]"),O.myInstance=null,this.globalevents.unsubscribe(r.ON_ORIENTATION_CHANGED,e=>{this.onOrientationChange2(e)}),this.scale.off("orientationchange",this.onOrientationChange,this),this.presentation1.scene.restart(),this.backgroundScene.scene.restart(),this.scene.restart("GameScene")});l(this,"addSection",({section:e,position:n})=>{e.setPosition(n),e.start({game:this,position:n}),this.sections.push(e)});l(this,"getSection",e=>this.sections.find(n=>n.id==e));l(this,"gotoNode",e=>{const n=this.getSection(e);if(this.currentNodeID!=null){const i=this.getSection(this.currentNodeID),o=this.getOutPosition(n.getPosition(),this.currentNodeID);console.log(`move started, currentNode:${this.currentNodeID}`);const h=this.currentNodeID;this.move(this.currentNodeID,o.top,o.left,()=>{this.globalevents.notify(r.ON_NODE_END_OUT,h)}),i.setPosition(o.positionResult)}this.globalevents.notify(r.ON_NODE_START_IN,e),this.globalevents.notify(r.ON_NODE_START_OUT,this.currentNodeID),this.move(e,0,0,()=>{this.globalevents.notify(r.ON_NODE_END_IN,this.currentNodeID)}),this.currentNodeID=e,this.globalevents.notify(r.ON_NODE_CHANGE,this.reversePosition(n.getPosition())),n.setPosition(s.CENTER)});l(this,"move",(e,n,i,o)=>{this.getSection(e).moveTo(n,i,o)});l(this,"getOutPosition",(e,n)=>{let i=0,o=0,h=s.LEFT,d=0;switch(e){case s.LEFT:i=this.W+d,h=s.RIGHT;break;case s.RIGHT:i=-(this.W+d),h=s.LEFT;break;case s.TOP:o=this.H+d,h=s.BOTTOM;break;case s.BOTTOM:o=-(this.H+d),h=s.TOP;break}return{top:o,left:i,positionResult:h}});l(this,"reversePosition",e=>{switch(e){case s.LEFT:return s.RIGHT;case s.RIGHT:return s.LEFT;case s.TOP:return s.BOTTOM;case s.BOTTOM:return s.TOP}})}preload(){console.log("preload"),this.firstRunPortrait=this.scale.orientation=="portrait-primary",this.orientation=this.getScaleOrientation(),console.log(`[preload] this.firstRunPortrait:${this.firstRunPortrait}`),console.log(`[preload] this.scale.orientation:${this.scale.orientation}`),c.H=this.scale.gameSize.height,c.W=this.scale.gameSize.width,this.load.plugin("rexbbcodetextplugin","https://raw.githubusercontent.com/rexrainbow/phaser3-rex-notes/master/dist/rexbbcodetextplugin.min.js",!0),this.showDisplayMode()}getScaleOrientation(){let e;return this.scale.orientation=="portrait-primary"?e=s.PORTRAIT:e=s.LANDSCAPE,e}onOrientationChange2(e){this.orientation=e.orientation,console.log(`[onOrientationChange2] newOrientation:${this.orientation}`),this.showDisplayMode()}create(){console.log("create"),this.sections=[],this.currentNode=void 0,this.presentation1=this.scene.get("Presentation1"),this.addSection({section:this.presentation1,position:s.BOTTOM}),this.backgroundScene=this.scene.get("BackgroundScene"),this.backgroundScene.start(this),this.FPStext=this.add.text(0,0,"FPS:"),this.versionText=this.add.text(0,0,`v${s.version}`,{align:"right"}),this.versionText.x=c.W-this.versionText.width,this.logText=this.add.text(0,0,"",{align:"left"}),this.logText.y=30,this.globalevents=r.getInstance(),this.logger=O.getInstance({text:this.logText}),this.logger.log(`firstRunPortrait:${this.firstRunPortrait}`),this.gotoNode("Presentation1"),this.globalevents.subscribe(r.ON_ORIENTATION_CHANGED,e=>{this.onOrientationChange2(e)})}showDisplayMode(){console.log(`showDisplayMode:${this.orientation}`),this.orientation==s.LANDSCAPE?(document.getElementById("turn").style.display="none",this.firstRunPortrait&&this.cleanScenes()):document.getElementById("turn").style.display="block"}handler(e){e.setTint(16711680)}update(){var e=this.sys.game.loop;this.FPStext.text=`FPS:${e.actualFps}`}}class T extends Phaser.Scene{constructor(t){super({key:t,active:!0}),this.id=t,this.globalevents=r.getInstance()}create({margin:t=0,position:e=s.LEFT}){switch(this.position=e,this.sectionW=c.W-t*2,this.sectionH=c.H-t*2,this.view=this.add.container(),e){case s.LEFT:this.view.x=-(c.W+t);break;case s.RIGHT:this.view.x=c.W+t;break;case s.TOP:this.view.y=-(c.H+t);break;case s.BOTTOM:this.view.y=c.H+t;break}}getPosition(){return this.position}setPosition(t){this.position=t}show(){this.tweens.add({targets:this.view,x:0,y:0,duration:1e3,ease:s.easing,callbackScope:this,onComplete:function(){}})}moveTo(t,e,n){this.tweens.add({targets:this.view,x:t,y:e,duration:1e3,ease:s.easing,callbackScope:this,onComplete:function(){n==null||n()}})}scaleImage({type:t,value:e,side:n,img:i}){const o=i.width,h=i.height,d=o/h,N=h/o;let u=0,g=0;t=="percent"?n=="width"?(u=o*e,g=N*u):(g=h*e,u=d*g):n=="width"?(u=e,g=N*u):(g=e,u=d*g),i.displayWidth=u,i.displayHeight=g}centerIMG(t){const e=t.displayWidth,n=t.displayHeight,i=this.scale.gameSize.width*.5-e*.5,o=this.scale.gameSize.height*.5-n*.5;return t.x=i,t.y=o,{x:i,y:o}}}class S{constructor({text:t,game:e,view:n,width:i=100,height:o=100,x:h=0,y:d=0,spriteName:N="bgButton",fontFamily:u='"Roboto", "Roboto-Bold", serif',color:g="white",fontSize:f=18,callback:E=void 0}){this.callback=E,this.button=e.add.container(),this.image=e.make.nineslice({x:0,y:0,key:N,width:i,height:o,leftWidth:0,rightWidth:0,topHeight:0,bottomHeight:0,add:!0}),this.text=e.add.rexBBCodeText(0,0,t,{fontFamily:u,fontSize:f,color:g}).setInteractive(),this.button.add(this.image),this.button.add(this.text),this.button.x=h,this.button.y=d,n.add(this.button),this.displayWidth=i,this.displayHeight=o;const m=this;this.text.on("pointerdown",function(){m.onClick()})}onClick(){var t;(t=this.callback)==null||t.call(this)}}class P extends T{constructor(){super("Presentation1")}start({game:t,position:e}){super.create({position:e}),this.game=t,this.perfume=this.game.add.image(0,0,"perfume").setOrigin(0,0).setInteractive(),this.perfume.name="perfume",this.view.add(this.perfume),this.scaleImage({img:this.perfume,type:"pixels",value:this.sectionH*.7,side:"height"}),this.centerIMG(this.perfume),this.presentationText=this.add.rexBBCodeText(0,0,"PRESENTACIÓN [b]TÍTULO[/b]",{fontFamily:'"Roboto", "Roboto-Bold", serif',fontSize:64,color:"#5656ee"}),this.centerIMG(this.presentationText),this.textButton=new S({game:this.game,text:"SIGUIENTE",view:this.view,x:100,y:100,width:219,height:168,spriteName:"bgButton"}),this.game.make.nineslice({x:200,y:500,key:"splash",add:!0}),this.centerIMG(this.textButton),this.game.input.on("gameobjectdown",(n,i)=>{i.name=="perfume"&&(this.moveRandom(),this.globalevents.notify(r.ON_NODE_CHANGE,s.BOTTOM))})}moveRandom(){const t=Phaser.Math.Between(this.perfume.displayWidth,c.W-this.perfume.displayWidth),e=Phaser.Math.Between(this.perfume.displayHeight,c.H-this.perfume.displayHeight);this.tweens.add({targets:this.perfume,x:t,y:e,duration:1e3,ease:s.easing,callbackScope:this,onComplete:function(){}})}}class w extends T{constructor(){super("Presentation2")}}class x extends Phaser.Scene{constructor(){super("PreloadScene")}preload(){this.load.image("splash","/splash.png"),this.load.image("perfume","/perfume.png"),this.load.image("bgButton","/buttons/bgButton.png"),this.load.image("bg","/background.jpg")}create(){console.log("Preloaded finished"),this.scene.switch("GameScene")}}const R={type:Phaser.CANVAS,backgroundColor:"#000000",scale:{mode:Phaser.Scale.RESIZE,parent:"phaser-example",width:window.innerWidth,height:window.innerHeight},scene:[x,b,_,P,w]},p=r.getInstance();window.onresize=function(){window.innerWidth>window.innerHeight?(console.log("window.onresize LANDSCAPE detected"),p.notify(r.ON_ORIENTATION_CHANGED,{orientation:s.LANDSCAPE})):(console.log("window.onresize PORTRAIT detected"),p.notify(r.ON_ORIENTATION_CHANGED,{orientation:s.PORTRAIT}))};new Phaser.Game(R);
