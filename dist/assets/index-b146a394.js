var m=Object.defineProperty;var E=(h,t,e)=>t in h?m(h,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):h[t]=e;var d=(h,t,e)=>(E(h,typeof t!="symbol"?t+"":t,e),e);(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))o(i);new MutationObserver(i=>{for(const n of i)if(n.type==="childList")for(const a of n.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&o(a)}).observe(document,{childList:!0,subtree:!0});function e(i){const n={};return i.integrity&&(n.integrity=i.integrity),i.referrerPolicy&&(n.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?n.credentials="include":i.crossOrigin==="anonymous"?n.credentials="omit":n.credentials="same-origin",n}function o(i){if(i.ep)return;i.ep=!0;const n=e(i);fetch(i.href,n)}})();class s{}s.version="0.0.4";s.LEFT="LEFT";s.RIGHT="RIGHT";s.TOP="TOP";s.BOTTOM="BOTTOM";s.CENTER="CENTER";s.easing="Cubic.easeOut";class r{constructor(){this.events={}}subscribe(t="",e){this.events[t]==null&&(this.events[t]=[]),this.events[t].push(e)}unsubscribe(t="",e){this.events[t]!=null&&(this.events[t]=this.events[t].filter(o=>o!==e))}notify(t="",e){var o;(o=this.events[t])==null||o.forEach(i=>i(e))}}r.myInstance=null;r.getInstance=()=>(r.myInstance==null&&(r.myInstance=new r),r.myInstance);r.ON_NODE_CHANGE="ON_NODE_CHANGE";r.ON_DOORS_OPENED="ON_DOORS_OPENED";r.ON_DOORS_START_OPENING="ON_DOORS_START_OPENING";r.ON_NODE_START_IN="ON_NODE_START_IN";r.ON_NODE_END_IN="ON_NODE_END_IN";r.ON_NODE_START_OUT="ON_NODE_START_OUT";r.ON_NODE_END_OUT="ON_NODE_END_OUT";r.ON_SWIPE_GESTURE="ON_SWIPE_GESTURE";r.ON_REQUEST_NEW_NODE="ON_REQUEST_NEW_NODE";r.ON_PROGRESS_LOADING="ON_PROGRESS_LOADING";r.ON_LOADING_COMPLETED="ON_LOADING_COMPLETED";class _ extends Phaser.Scene{constructor(){super({key:"BackgroundScene",active:!0});d(this,"gameScene");d(this,"layer");d(this,"onChange",e=>{switch(console.log(`nos hemos de mover a ${e}`),e){case s.LEFT:this.x-=this.offset;break;case s.RIGHT:this.x+=this.offset;break;case s.TOP:this.y-=this.offset;break;case s.BOTTOM:this.y+=this.offset;break}this.tweens.add({targets:this.view,x:this.x,y:this.y,duration:1e3,ease:s.easing,callbackScope:this,onComplete:function(){}})});this.offset=250,r.getInstance().subscribe(r.ON_NODE_CHANGE,this.onChange)}start(e){this.game=e,this.view=this.game.add.image(0,0,"bg").setOrigin(0,0),this.view.x=-1e3,this.view.y=-1e3,this.x=this.view.x,this.y=this.view.y}create(){console.log("create bg"),this.scale.gameSize.width,this.scale.gameSize.height}}class c{}c.W=0;c.H=0;class y extends Phaser.Scene{constructor(){super("GameScene");d(this,"addSection",({section:e,position:o})=>{e.setPosition(o),e.start({game:this,position:o}),this.sections.push(e)});d(this,"getSection",e=>this.sections.find(o=>o.id==e));d(this,"gotoNode",e=>{const o=this.getSection(e);if(this.currentNodeID!=null){const i=this.getSection(this.currentNodeID),n=this.getOutPosition(o.getPosition(),this.currentNodeID);console.log(`move started, currentNode:${this.currentNodeID}`);const a=this.currentNodeID;this.move(this.currentNodeID,n.top,n.left,()=>{this.globalevents.notify(r.ON_NODE_END_OUT,a)}),i.setPosition(n.positionResult)}this.globalevents.notify(r.ON_NODE_START_IN,e),this.globalevents.notify(r.ON_NODE_START_OUT,this.currentNodeID),this.move(e,0,0,()=>{this.globalevents.notify(r.ON_NODE_END_IN,this.currentNodeID)}),this.currentNodeID=e,console.log(o),this.globalevents.notify(r.ON_NODE_CHANGE,this.reversePosition(o.getPosition())),o.setPosition(s.CENTER)});d(this,"move",(e,o,i,n)=>{this.getSection(e).moveTo(o,i,n)});d(this,"getOutPosition",(e,o)=>{let i=0,n=0,a=s.LEFT,l=0;switch(e){case s.LEFT:i=this.W+l,a=s.RIGHT;break;case s.RIGHT:i=-(this.W+l),a=s.LEFT;break;case s.TOP:n=this.H+l,a=s.BOTTOM;break;case s.BOTTOM:n=-(this.H+l),a=s.TOP;break}return{top:n,left:i,positionResult:a}});d(this,"reversePosition",e=>{switch(e){case s.LEFT:return s.RIGHT;case s.RIGHT:return s.LEFT;case s.TOP:return s.BOTTOM;case s.BOTTOM:return s.TOP}})}preload(){this.logs=[],c.H=this.scale.gameSize.height,c.W=this.scale.gameSize.width,this.load.image("splash","/splash.png"),this.load.image("perfume","/perfume.png"),this.load.image("bgButton","/buttons/bgButton.png"),this.load.image("bg","/background.jpg"),this.load.plugin("rexbbcodetextplugin","https://raw.githubusercontent.com/rexrainbow/phaser3-rex-notes/master/dist/rexbbcodetextplugin.min.js",!0),this.scale.on("orientationchange",(e,o,i,n)=>{console.log(this.scale.orientation),this.showDisplayMode()}),this.showDisplayMode()}showDisplayMode(){this.scale.orientation=="landscape-primary"?document.getElementById("turn").style.display="none":(console.log("Incorrect"),document.getElementById("turn").style.display="block")}create(){this.globalevents=r.getInstance(),this.sections=[],this.currentNode=void 0,this.presentation1=this.scene.get("Presentation1"),this.addSection({section:this.presentation1,position:s.BOTTOM}),this.backgroundScene=this.scene.get("BackgroundScene"),this.backgroundScene.start(this),this.FPStext=this.add.text(0,0,"FPS:"),this.versionText=this.add.text(0,0,`v${s.version}`,{align:"right"}),this.versionText.x=c.W-this.versionText.width,this.logText=this.add.text(0,0,"",{align:"left"}),this.logText.y=30,this.gotoNode("Presentation1")}handler(e){e.setTint(16711680)}update(){var e=this.sys.game.loop;this.FPStext.text=`FPS:${e.actualFps}`,this.logText.text=this.logs.join(`
`)}}class p extends Phaser.Scene{constructor(t){super({key:t,active:!0}),this.id=t,this.globalevents=r.getInstance()}create({margin:t=0,position:e=s.LEFT}){switch(this.position=e,this.sectionW=c.W-t*2,this.sectionH=c.H-t*2,this.view=this.add.container(),e){case s.LEFT:this.view.x=-(c.W+t);break;case s.RIGHT:this.view.x=c.W+t;break;case s.TOP:this.view.y=-(c.H+t);break;case s.BOTTOM:this.view.y=c.H+t;break}}getPosition(){return this.position}setPosition(t){this.position=t}show(){this.tweens.add({targets:this.view,x:0,y:0,duration:1e3,ease:s.easing,callbackScope:this,onComplete:function(){}})}moveTo(t,e,o){this.tweens.add({targets:this.view,x:t,y:e,duration:1e3,ease:s.easing,callbackScope:this,onComplete:function(){o==null||o()}})}scaleImage({type:t,value:e,side:o,img:i}){const n=i.width,a=i.height,l=n/a,O=a/n;let u=0,g=0;t=="percent"?o=="width"?(u=n*e,g=O*u):(g=a*e,u=l*g):o=="width"?(u=e,g=O*u):(g=e,u=l*g),i.displayWidth=u,i.displayHeight=g}centerIMG(t){const e=t.displayWidth,o=t.displayHeight,i=this.scale.gameSize.width*.5-e*.5,n=this.scale.gameSize.height*.5-o*.5;return t.x=i,t.y=n,{x:i,y:n}}}class b{constructor({text:t,game:e,view:o,width:i=100,height:n=100,x:a=0,y:l=0,spriteName:O="bgButton",fontFamily:u='"Roboto", "Roboto-Bold", serif',color:g="white",fontSize:N=18,callback:T=void 0}){this.callback=T,this.button=e.add.container(),this.image=e.make.nineslice({x:0,y:0,key:O,width:i,height:n,leftWidth:0,rightWidth:0,topHeight:0,bottomHeight:0,add:!0}),console.log(this.image),this.text=e.add.rexBBCodeText(0,0,t,{fontFamily:u,fontSize:N,color:g}).setInteractive(),this.button.add(this.image),this.button.add(this.text),this.button.x=a,this.button.y=l,o.add(this.button),this.displayWidth=i,this.displayHeight=n;const f=this;this.text.on("pointerdown",function(){f.onClick()})}onClick(){var t;(t=this.callback)==null||t.call(this)}}class S extends p{constructor(){super("Presentation1")}start({game:t,position:e}){super.create({position:e}),this.game=t,this.perfume=this.game.add.image(0,0,"perfume").setOrigin(0,0).setInteractive(),this.perfume.name="perfume",this.view.add(this.perfume),console.log(`this.perfume:${this.perfume.displayWidth} this.sectionH:${this.sectionH}`),this.scaleImage({img:this.perfume,type:"pixels",value:this.sectionH*.7,side:"height"}),this.centerIMG(this.perfume),this.presentationText=this.add.rexBBCodeText(0,0,"PRESENTACIÓN [b]TÍTULO[/b]",{fontFamily:'"Roboto", "Roboto-Bold", serif',fontSize:64,color:"#5656ee"}),this.centerIMG(this.presentationText),this.textButton=new b({game:this.game,text:"SIGUIENTE",view:this.view,x:100,y:100,width:219,height:168,spriteName:"bgButton"}),this.game.make.nineslice({x:200,y:500,key:"splash",add:!0}),this.centerIMG(this.textButton),this.game.input.on("gameobjectdown",(o,i)=>{i.name=="perfume"&&(this.moveRandom(),this.globalevents.notify(r.ON_NODE_CHANGE,s.BOTTOM))})}moveRandom(){const t=Phaser.Math.Between(this.perfume.displayWidth,c.W-this.perfume.displayWidth),e=Phaser.Math.Between(this.perfume.displayHeight,c.H-this.perfume.displayHeight);this.tweens.add({targets:this.perfume,x:t,y:e,duration:1e3,ease:s.easing,callbackScope:this,onComplete:function(){}})}}class x extends p{constructor(){super("Presentation2")}}const I={type:Phaser.CANVAS,backgroundColor:"#000000",scale:{mode:Phaser.Scale.RESIZE,parent:"phaser-example",width:window.innerWidth,height:window.innerHeight},scene:[y,_,S,x]};new Phaser.Game(I);
